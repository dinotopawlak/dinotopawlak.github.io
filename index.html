<!DOCTYPE html>
<html>

<head>
	<meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link rel="stylesheet" href="index.css">
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Quicksand&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@20..48,100..700,0..1,-50..200" />
</head>

<body>
  <div id="menu"> 
    <button class="round-btn ripple" onclick="reset()"><img class="icon" src="/icons/reset.svg"/></button>
    <button class="round-btn ripple" onclick="help()"><img class="icon" src="/icons/lightbulb.svg"/></button>
    <button class="round-btn ripple" style="background-color: #010409" onclick="window.location = 'https://github.com/dinotopawlak/dinotopawlak.github.io'">
        <img class="icon" src="/icons/github.svg"/>
    </button>
  </div>
  <div id="progress_indicator"></div>
  <div id="container">
    <p id="myQuestion"></p>

    <!--return false to prevent reloading-->
    <form onsubmit="getInputValue(); return false" id="form">
      <input type="text" id="Myinput" autocomplete="off" placeholder="Hier das Wort  schreiben" />
      <button type="submit" id="Antwortbutton" class="btn ripple">Submit</button>
      <br>
    </form>
    <!-- <br> -->
    <!-- <button onclick="reset()" class="btn waves-effect">Reset Progress</button> -->
    <!-- <br> -->
    <!-- <button onclick="help()" class="btn">Solution</button> -->
    <div style="color: crimson;" id="error" class="info"></div>
    <div id="help" class="info"></div>
  </div>

 	<script>

		const storedTasks = { ...localStorage };
		let progress_locked = false;
		let tasks = []
		let possible_tasks = []
		
		
		const myInput = document.getElementById("Myinput");
		const progress_indicator = document.getElementById("progress_indicator");
		let thisTask = {};
		let countSolution = 0

		
		document.addEventListener("keydown", (event) => {
			if (event.key == "ArrowDown") {
				help();
			}

		})

		load_questionsanswers();


		function load_questionsanswers() {
			function reqListener() {
				tasks = JSON.parse(this.responseText);
				console.log(tasks.length);
				possible_tasks = tasks.filter((task) => {
					let storedItem = storedTasks[task.question];
					if (storedItem != undefined) {
						if (storedItem != false) {
							return false
						}
					}
					return true

				})
				
				if (possible_tasks.length == 0) {
					myInput.disabled = true;
					alert("Alles gelernt, wenn nochmal, dann auf Reset drücken");

					return;
				} 
				thisTask = possible_tasks[Math.floor(Math.random() * possible_tasks.length)]
				document.getElementById("myQuestion").innerHTML = thisTask.question
				progress_indicator.innerHTML = `Progress: ${tasks.length - possible_tasks.length}/${tasks.length}`;
			}

			const req = new XMLHttpRequest();
			req.addEventListener("load", reqListener);
			req.open("GET", "/tasks.json");
			req.send();
		}
		

		function save_progress(question, is_done) {
			if (progress_locked) {
				return;
			}
			localStorage.setItem(question, is_done)
		}

		function getInputValue() {
			if (myInput.value.toLowerCase() === thisTask.answer.toLowerCase()) {
				if (countSolution != 0) {
					progress_locked = true;
				}

				save_progress(thisTask.question, true)
				alert("Muy bien :)");
				window.location.reload()
			} else {
				progress_locked = true;
				save_progress(thisTask.question, false)
				document.getElementById("error").innerHTML = "Esta mal!!! Inténtalo otra vez";
			}
		}



		function reset() {
			localStorage.clear();
			window.location.reload();
		}

		myInput.select();
		function help() {
			//window.alert(thisTask.answer)
			countSolution = countSolution + 1
			let solution = ""
			const stringlength = thisTask.answer.length
			if (countSolution > 6) {
				solution = thisTask.answer
			} else {
				for (let i = 0; i < stringlength; i++) {
					if (i < countSolution) {
						solution = solution + thisTask.answer.charAt(i)
					} else {
						solution = solution + "*"
					}

				}
			}
      document.getElementById("help").innerHTML = `Help: ${solution}`
		}

	</script>

</body>

</html>
